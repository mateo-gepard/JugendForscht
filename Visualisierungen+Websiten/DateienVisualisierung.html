<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Results Dashboard - VR vs Non-VR</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --vr-color: #3b82f6;
            --non-vr-color: #ec4899;
            --bg: #0f1419;
            --bg-card: #1a1f2e;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #2d3748;
        }

        :root[data-theme="light"] {
            --vr-color: #2563eb;
            --non-vr-color: #db2777;
            --bg: #f8fafc;
            --bg-card: #ffffff;
            --text: #0f172a;
            --text-muted: #475569;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 12px;
            gap: 10px;
        }

        header {
            text-align: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            position: relative;
        }

        h1 {
            font-size: 1.25rem;
            color: var(--text);
            margin-bottom: 4px;
            font-weight: 600;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
            user-select: none;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.05);
        }

        :root[data-theme="light"] .theme-toggle:hover {
            background: rgba(0,0,0,0.05);
        }

        /* Navigation Toggle */
        .nav-toggle {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .nav-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-btn:hover {
            color: var(--text);
            background: rgba(255,255,255,0.05);
        }

        .nav-btn.active {
            background: var(--vr-color);
            color: white;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .stat {
            background: var(--bg-card);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.65rem;
            margin-top: 2px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .charts {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: 1fr 1fr;
            gap: 10px;
            min-height: 0;
            overflow: hidden;
        }

        .chart {
            background: var(--bg-card);
            border-radius: 6px;
            padding: 12px;
            border: 1px solid var(--border);
            min-height: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .chart.span-2 {
            grid-column: span 2;
        }

        .chart-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }

        .chart-content {
            flex: 1;
            min-height: 0;
            overflow: hidden;
            position: relative;
        }

        /* Dashboard views */
        .dashboard-view {
            display: none;
            flex: 1;
            flex-direction: column;
            gap: 10px;
            min-height: 0;
            overflow: hidden;
        }

        .dashboard-view.active {
            display: flex;
        }

        /* Qualitative Dashboard Styles - 8 Questions Grid */
        .qual-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        .qual-main-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            min-height: 0;
            overflow: hidden;
        }

        .qual-q-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: border-color 0.2s, transform 0.2s;
        }

        .qual-q-card:hover {
            border-color: var(--vr-color);
        }

        .qual-q-header {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .qual-q-number {
            width: 24px;
            height: 24px;
            min-width: 24px;
            background: linear-gradient(135deg, var(--vr-color), var(--non-vr-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
        }

        .qual-q-title-wrap {
            flex: 1;
            min-width: 0;
        }

        .qual-q-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 2px;
        }

        .qual-q-question {
            font-size: 0.6rem;
            color: var(--text-muted);
            line-height: 1.3;
        }

        .qual-q-stats {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            flex-shrink: 0;
        }

        .qual-q-stat {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .qual-q-stat-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .qual-q-stat-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .qual-q-stat-fill.vr {
            background: var(--vr-color);
        }

        .qual-q-stat-fill.non-vr {
            background: var(--non-vr-color);
        }

        .qual-q-stat-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .qual-q-stat-label {
            font-size: 0.55rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .qual-q-stat-value {
            font-size: 0.7rem;
            font-weight: 600;
        }

        .qual-q-stat-value.vr {
            color: var(--vr-color);
        }

        .qual-q-stat-value.non-vr {
            color: var(--non-vr-color);
        }

        .qual-q-quotes {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
            overflow-y: auto;
            min-height: 0;
            padding-right: 4px;
        }

        .qual-quote {
            background: rgba(0,0,0,0.25);
            border-radius: 4px;
            padding: 6px 8px;
            border-left: 3px solid var(--vr-color);
            flex-shrink: 0;
        }

        .qual-quote.non-vr {
            border-left-color: var(--non-vr-color);
        }

        .qual-quote-text {
            font-size: 0.55rem;
            color: var(--text);
            font-style: italic;
            line-height: 1.3;
            margin-bottom: 3px;
        }

        .qual-quote-meta {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.5rem;
        }

        .qual-quote-name {
            font-weight: 600;
            color: var(--text);
        }

        .qual-quote-badge {
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 0.45rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .qual-quote-badge.vr {
            background: rgba(59, 130, 246, 0.2);
            color: var(--vr-color);
        }

        .qual-quote-badge.non-vr {
            background: rgba(236, 72, 153, 0.2);
            color: var(--non-vr-color);
        }

        .qual-quote-score {
            margin-left: auto;
            color: var(--text-muted);
        }

        .qual-quote.vr .qual-quote-score {
            color: var(--vr-color);
        }

        .qual-quote.non-vr .qual-quote-score {
            color: var(--non-vr-color);
        }

        /* Legend */
        .qual-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            padding: 8px;
            background: var(--bg-card);
            border-radius: 6px;
            border: 1px solid var(--border);
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .qual-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .qual-legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .qual-legend-dot.vr {
            background: var(--vr-color);
        }

        .qual-legend-dot.non-vr {
            background: var(--non-vr-color);
        }

        /* Scrollbar styling */
        .qual-q-quotes::-webkit-scrollbar {
            width: 4px;
        }

        .qual-q-quotes::-webkit-scrollbar-track {
            background: var(--bg);
            border-radius: 2px;
        }

        .qual-q-quotes::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .qual-q-quotes::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Triangulation Dashboard Styles */
        .tri-container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr;
            gap: 12px;
            min-height: 0;
            overflow: hidden;
        }

        .tri-header {
            grid-column: span 2;
            display: flex;
            gap: 12px;
        }

        .tri-insight {
            flex: 1;
            background: var(--bg-card);
            border-radius: 8px;
            padding: 12px 16px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tri-insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .tri-insight-icon.finding {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .tri-insight-icon.paradox {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .tri-insight-icon.vr-effect {
            background: linear-gradient(135deg, var(--vr-color), #2563eb);
        }

        .tri-insight-content {
            flex: 1;
        }

        .tri-insight-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 2px;
        }

        .tri-insight-desc {
            font-size: 0.6rem;
            color: var(--text-muted);
            line-height: 1.3;
        }

        .tri-panel {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 14px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tri-panel-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .tri-panel-content {
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .tri-profiles {
            display: flex;
            flex-direction: column;
            gap: 8px;
            overflow-y: auto;
            height: 100%;
            padding-right: 4px;
        }

        .tri-profile {
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            padding: 10px 12px;
            border-left: 3px solid var(--vr-color);
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
        }

        .tri-profile.non-vr {
            border-left-color: var(--non-vr-color);
        }

        .tri-profile-header {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tri-profile-name {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text);
        }

        .tri-profile-badge {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .tri-profile-badge.vr {
            background: rgba(59, 130, 246, 0.2);
            color: var(--vr-color);
        }

        .tri-profile-badge.non-vr {
            background: rgba(236, 72, 153, 0.2);
            color: var(--non-vr-color);
        }

        .tri-profile-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .tri-profile-score-value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .tri-profile-score-value.vr {
            color: var(--vr-color);
        }

        .tri-profile-score-value.non-vr {
            color: var(--non-vr-color);
        }

        .tri-profile-score-label {
            font-size: 0.5rem;
            color: var(--text-muted);
        }

        .tri-profile-details {
            grid-column: span 2;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid var(--border);
        }

        .tri-profile-detail {
            text-align: center;
        }

        .tri-profile-detail-value {
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text);
        }

        .tri-profile-detail-label {
            font-size: 0.45rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .tri-profile-quote {
            grid-column: span 2;
            font-size: 0.55rem;
            font-style: italic;
            color: var(--text-muted);
            line-height: 1.3;
            margin-top: 4px;
        }

        .tri-chart {
            height: 100%;
        }

        .tri-case {
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
        }

        .tri-case-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .tri-case-name {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text);
        }

        .tri-case-tag {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .tri-case-tag.paradox {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .tri-case-tag.expected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .tri-case-tag.vr-boost {
            background: rgba(59, 130, 246, 0.2);
            color: var(--vr-color);
        }

        .tri-case-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .tri-case-quant, .tri-case-qual {
            font-size: 0.55rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .tri-case-quant strong, .tri-case-qual strong {
            color: var(--text);
        }

        .tri-profiles::-webkit-scrollbar {
            width: 4px;
        }

        .tri-profiles::-webkit-scrollbar-track {
            background: var(--bg);
            border-radius: 2px;
        }

        .tri-profiles::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        @media (max-width: 1400px) {
            .charts {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(3, 1fr);
            }
            .chart.span-2 {
                grid-column: span 2;
            }
            .qual-main-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
            .tri-container {
                grid-template-columns: 1fr;
            }
            .tri-header {
                grid-column: span 1;
                flex-direction: column;
            }
        }

        @media (max-width: 1000px) {
            .qual-main-grid {
                grid-template-columns: 1fr;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="theme-toggle" onclick="toggleTheme()" title="Theme wechseln">
                <span id="themeIcon">ðŸŒ™</span>
            </div>
            <h1 id="dashboardTitle">Quantitative Analyse</h1>
            <p class="subtitle">VR vs Non-VR Learning Groups</p>
            <div class="nav-toggle">
                <button class="nav-btn active" onclick="showDashboard('quantitative')">Quantitativ</button>
                <button class="nav-btn" onclick="showDashboard('qualitative')">Qualitativ</button>
                <button class="nav-btn" onclick="showDashboard('triangulation')">Triangulation</button>
            </div>
        </header>

        <!-- Quantitative Dashboard -->
        <div id="quantitative-view" class="dashboard-view active">
            <div class="stats" id="stats"></div>

            <div class="charts">
                <div class="chart">
                    <h2 class="chart-title">Gesamtpunkte</h2>
                    <div class="chart-content" id="violinPlot"></div>
                </div>

                <div class="chart">
                    <h2 class="chart-title">Schwierigkeit</h2>
                    <div class="chart-content" id="difficultyChart"></div>
                </div>

                <div class="chart">
                    <h2 class="chart-title">Kompetenzen</h2>
                    <div class="chart-content" id="competencyChart"></div>
                </div>

                <div class="chart span-2">
                    <h2 class="chart-title">Leistung pro Aufgabe</h2>
                    <div class="chart-content" id="taskBarChart"></div>
                </div>

                <div class="chart">
                    <h2 class="chart-title">Heatmap</h2>
                    <div class="chart-content" id="heatmap"></div>
                </div>
            </div>
        </div>

        <!-- Qualitative Dashboard -->
        <div id="qualitative-view" class="dashboard-view">
            <div class="qual-legend">
                <div class="qual-legend-item">
                    <div class="qual-legend-dot vr"></div>
                    <span>VR Gruppe (n=5 Interviews)</span>
                </div>
                <div class="qual-legend-item">
                    <div class="qual-legend-dot non-vr"></div>
                    <span>Non-VR Gruppe (n=7 Interviews)</span>
                </div>
            </div>
            <div class="qual-container" id="qualContainer"></div>
        </div>

        <!-- Triangulation Dashboard -->
        <div id="triangulation-view" class="dashboard-view">
            <div class="tri-container" id="triContainer"></div>
        </div>
    </div>

    <script>
        // Theme Management
        function toggleTheme() {
            const root = document.documentElement;
            const currentTheme = root.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            root.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
            
            // Recreate charts with new theme
            setTimeout(() => {
                createCharts();
            }, 100);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('themeIcon');
            icon.textContent = theme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
        }

        // Load saved theme on page load
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        })();

        // Get current theme colors
        function getThemeColors() {
            const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
            return {
                plotBg: isDark ? 'rgba(0,0,0,0)' : 'rgba(248,250,252,0)',
                paperBg: isDark ? 'rgba(0,0,0,0)' : 'rgba(255,255,255,0)',
                textColor: isDark ? '#e2e8f0' : '#0f172a',
                mutedColor: isDark ? '#94a3b8' : '#475569',
                gridColor: isDark ? '#2d3748' : '#e2e8f0',
                isDark: isDark
            };
        }

        // Parse CSV data - NEW LARGER DATASET
        const csvData = `Name,Group,Task_1a,Task_1b,Task_1c,Task_2,Task_3,Task_4a,Task_4b,Task_5a,Task_5b,Task_6a,Task_6b
Konstantin Romanie,VR,1,1,1,1,1,0,0,0,0,0.5,1
Louis Plettner,VR,1,1,1,1,1,0,0,1,1,1,0.5
Henri Olufemi,VR,1,1,1,1,1,1,1,1,1,0.5,0.5
Floyd,VR,1,1,1,1,0.5,0,0,1,1,1,0
Marlon Burg,VR,0,0,0,0,1,0,0,1,0,1,1
VR_06,VR,1,1,1,1,1,1,0.5,1,1,1,0.5
VR_07,VR,1,1,1,1,0.5,0.5,1,1,1,0.5,0.5
VR_08,VR,1,1,1,0.5,1,1,1,1,1,1,1
VR_09,VR,1,0.5,1,1,1,0.5,0.5,1,1,1,0.5
VR_10,VR,0.5,1,1,1,1,1,0.5,0.5,1,1,0.5
VR_11,VR,1,1,1,1,0.5,0.5,1,1,1,0.5,0
VR_12,VR,1,1,1,1,1,1,1,1,1,1,1
VR_13,VR,1,1,0.5,1,1,0.5,0.5,1,1,0.5,0.5
VR_14,VR,1,1,1,0.5,1,1,1,1,1,1,1
VR_15,VR,0.5,1,1,1,0.5,0.5,0.5,0.5,1,1,0.5
Sophia Kessler,Non-VR,1,1,1,1,0.5,1,1,0,0.5,0.5,0
Farah Raad,Non-VR,0,0,0,0,0.5,1,1,1,0.5,0,0
Tilly Marr,Non-VR,1,1,1,0,0.5,1,1,0,0,0.5,0.5
Quentin Lumbondl,Non-VR,1,0,0,1,0,1,1,1,0,0.5,0
Alex Orthen,Non-VR,0,0,0,0,1,1,1,1,0.5,0,0
Lucia Naverth,Non-VR,1,0,0,0,1,1,0,0,0.5,0,0
Leni Koschinsky,Non-VR,1,0,0,1,0.5,0,0,1,0,0,0.5
NV_08,Non-VR,1,1,1,1,0.5,1,1,1,0.5,0,0
NV_09,Non-VR,0.5,1,0.5,1,0.5,1,1,1,0,0.5,0
NV_10,Non-VR,1,1,1,1,1,1,1,0.5,0.5,0.5,0
NV_11,Non-VR,0,0.5,0,0.5,0.5,1,1,1,0,0,0
NV_12,Non-VR,1,1,1,1,0.5,1,1,1,0.5,0.5,0
NV_13,Non-VR,0.5,0.5,0.5,1,0.5,1,1,0.5,0,0,0
NV_14,Non-VR,1,1,1,1,0.5,1,1,1,0.5,0.5,0
NV_15,Non-VR,0,0,0,0,0.5,1,1,1,0,0,0`;

        const rows = csvData.split('\n');
        const headers = rows[0].split(',');
        const taskHeaders = headers.slice(2);
        
        // Maximum points per task
        const maxPoints = {
            'Task_1a': 1,
            'Task_1b': 1,
            'Task_1c': 1,
            'Task_2': 2,
            'Task_3': 4,
            'Task_4a': 1,
            'Task_4b': 1,
            'Task_5a': 2,
            'Task_5b': 2,
            'Task_6a': 3,
            'Task_6b': 2
        };
        
        const students = rows.slice(1).map(row => {
            const values = row.split(',');
            const student = {
                name: values[0],
                group: values[1],
                tasks: {}
            };
            taskHeaders.forEach((task, i) => {
                const percentage = parseFloat(values[i + 2]);
                student.tasks[task] = percentage * maxPoints[task];
            });
            return student;
        });

        students.forEach(student => {
            student.totalPoints = Object.values(student.tasks).reduce((sum, val) => sum + val, 0);
        });

        const vrStudents = students.filter(s => s.group === 'VR');
        const nonVrStudents = students.filter(s => s.group === 'Non-VR');

        const vrTotal = vrStudents.reduce((sum, s) => sum + s.totalPoints, 0) / vrStudents.length;
        const nonVrTotal = nonVrStudents.reduce((sum, s) => sum + s.totalPoints, 0) / nonVrStudents.length;
        const overallAvg = students.reduce((sum, s) => sum + s.totalPoints, 0) / students.length;

        // Statistische Funktionen
        function calculateMean(values) {
            return values.reduce((sum, val) => sum + val, 0) / values.length;
        }

        function calculateStdDev(values) {
            const mean = calculateMean(values);
            const squaredDiffs = values.map(val => Math.pow(val - mean, 2));
            const variance = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;
            return Math.sqrt(variance);
        }

        function tTest(group1, group2) {
            const n1 = group1.length;
            const n2 = group2.length;
            const mean1 = calculateMean(group1);
            const mean2 = calculateMean(group2);
            const std1 = calculateStdDev(group1);
            const std2 = calculateStdDev(group2);
            
            const pooledStd = Math.sqrt(((n1 - 1) * std1 * std1 + (n2 - 1) * std2 * std2) / (n1 + n2 - 2));
            const tValue = (mean1 - mean2) / (pooledStd * Math.sqrt(1/n1 + 1/n2));
            const df = n1 + n2 - 2;
            
            // Vereinfachte p-Wert Approximation (fÃ¼r df > 30 verwenden wir Normalverteilung)
            const pValue = 2 * (1 - normalCDF(Math.abs(tValue)));
            return pValue;
        }

        function normalCDF(x) {
            // Approximation der kumulativen Verteilungsfunktion der Normalverteilung
            const t = 1 / (1 + 0.2316419 * Math.abs(x));
            const d = 0.3989423 * Math.exp(-x * x / 2);
            const prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            return x > 0 ? 1 - prob : prob;
        }

        // Berechne statistische Werte
        const vrPoints = vrStudents.map(s => s.totalPoints);
        const nonVrPoints = nonVrStudents.map(s => s.totalPoints);
        const vrStdDev = calculateStdDev(vrPoints);
        const nonVrStdDev = calculateStdDev(nonVrPoints);
        const pValue = tTest(vrPoints, nonVrPoints);

        const statsHtml = `
            <div class="stat">
                <div class="stat-value">${students.length}</div>
                <div class="stat-label">Teilnehmende</div>
            </div>
            <div class="stat">
                <div class="stat-value">${vrStudents.length}</div>
                <div class="stat-label">VR Gruppe</div>
            </div>
            <div class="stat">
                <div class="stat-value">${nonVrStudents.length}</div>
                <div class="stat-label">Non-VR Gruppe</div>
            </div>
            <div class="stat">
                <div class="stat-value">${vrTotal.toFixed(1)} Â± ${vrStdDev.toFixed(1)}</div>
                <div class="stat-label">VR Ã˜ Punkte (von 20)</div>
            </div>
            <div class="stat">
                <div class="stat-value">${nonVrTotal.toFixed(1)} Â± ${nonVrStdDev.toFixed(1)}</div>
                <div class="stat-label">Non-VR Ã˜ Punkte (von 20)</div>
            </div>
            <div class="stat">
                <div class="stat-value">${pValue < 0.001 ? '<0.001' : pValue.toFixed(3)}</div>
                <div class="stat-label">P-Wert (t-Test)</div>
            </div>
        `;
        document.getElementById('stats').innerHTML = statsHtml;

        function createCharts() {
            const colors = getThemeColors();
            
            // Chart theme - optimized for compact display with dynamic colors
            const theme = {
                plot_bgcolor: colors.plotBg,
                paper_bgcolor: colors.paperBg,
                font: { color: colors.textColor, size: 9, family: '-apple-system, BlinkMacSystemFont, Segoe UI, sans-serif' },
                margin: { l: 45, r: 25, t: 10, b: 35 },
                showlegend: true,
                legend: { 
                    orientation: 'h', 
                    y: -0.2,
                    x: 0.5, 
                    xanchor: 'center',
                    bgcolor: colors.paperBg,
                    font: { color: colors.mutedColor, size: 9 }
                },
                xaxis: { gridcolor: colors.gridColor, zerolinecolor: colors.gridColor, tickfont: { size: 8 } },
                yaxis: { gridcolor: colors.gridColor, zerolinecolor: colors.gridColor, tickfont: { size: 8 } }
            };

            const config = {responsive: true, displayModeBar: false};

        // 1. Violin/Box Plot mit Mittelwerten und Standardabweichungen
        Plotly.newPlot('violinPlot', [
            {
                type: 'box',
                y: vrStudents.map(s => s.totalPoints),
                name: 'VR',
                marker: { color: '#3b82f6', size: 4 },
                boxmean: 'sd',
                fillcolor: 'rgba(59, 130, 246, 0.3)',
                line: { color: '#3b82f6', width: 1.5 },
                hovertemplate: 'VR Gruppe<br>Wert: %{y:.1f}<br>Mittelwert: ' + vrTotal.toFixed(1) + '<br>Std: Â± ' + vrStdDev.toFixed(1) + '<extra></extra>'
            },
            {
                type: 'box',
                y: nonVrStudents.map(s => s.totalPoints),
                name: 'Non-VR',
                marker: { color: '#ec4899', size: 4 },
                boxmean: 'sd',
                fillcolor: 'rgba(236, 72, 153, 0.3)',
                line: { color: '#ec4899', width: 1.5 },
                hovertemplate: 'Non-VR Gruppe<br>Wert: %{y:.1f}<br>Mittelwert: ' + nonVrTotal.toFixed(1) + '<br>Std: Â± ' + nonVrStdDev.toFixed(1) + '<extra></extra>'
            }
        ], {
            ...theme,
            yaxis: { ...theme.yaxis, title: { text: 'Punkte', font: { size: 9 } } },
            autosize: true,
            annotations: [
                {
                    x: 0.25,
                    y: 1.15,
                    xref: 'paper',
                    yref: 'paper',
                    text: `MW: ${vrTotal.toFixed(1)} Â± ${vrStdDev.toFixed(1)}`,
                    showarrow: false,
                    font: { size: 8, color: '#3b82f6' }
                },
                {
                    x: 0.75,
                    y: 1.15,
                    xref: 'paper',
                    yref: 'paper',
                    text: `MW: ${nonVrTotal.toFixed(1)} Â± ${nonVrStdDev.toFixed(1)}`,
                    showarrow: false,
                    font: { size: 8, color: '#ec4899' }
                }
            ]
        }, config);

        // 2. Item Difficulty
        const difficulty = taskHeaders.map(task => {
            const total = students.reduce((sum, s) => sum + s.tasks[task], 0);
            const maxPossible = students.length * maxPoints[task];
            return (total / maxPossible) * 100;
        });

        Plotly.newPlot('difficultyChart', [{
            x: taskHeaders,
            y: difficulty,
            type: 'bar',
            marker: {
                color: difficulty.map(d => {
                    if (d >= 75) return '#ef4444';
                    if (d >= 50) return '#f59e0b';
                    return '#10b981';
                })
            },
            text: difficulty.map(d => d.toFixed(0)),
            textposition: 'outside',
            textfont: { color: '#e2e8f0', size: 8 },
            hovertemplate: '%{x}: %{y:.1f}%<extra></extra>'
        }], {
            ...theme,
            yaxis: { ...theme.yaxis, title: { text: '%', font: { size: 9 } }, range: [0, 110] },
            showlegend: false,
            autosize: true
        }, config);

        // 3. Competency Mapping
        const competencies = {
            'Symbol': ['Task_1a', 'Task_1b', 'Task_1c'],
            '2Dâ†’3D': ['Task_2', 'Task_3'],
            'Regeln': ['Task_4a', 'Task_4b'],
            'Transfer': ['Task_5a', 'Task_5b', 'Task_6a', 'Task_6b']
        };

        const competencyVR = {};
        const competencyNonVR = {};

        Object.entries(competencies).forEach(([comp, tasks]) => {
            const vrSum = vrStudents.reduce((sum, s) => {
                return sum + tasks.reduce((tSum, task) => tSum + s.tasks[task], 0);
            }, 0);
            const nonVrSum = nonVrStudents.reduce((sum, s) => {
                return sum + tasks.reduce((tSum, task) => tSum + s.tasks[task], 0);
            }, 0);
            
            const maxPossibleVR = vrStudents.length * tasks.reduce((sum, task) => sum + maxPoints[task], 0);
            const maxPossibleNonVR = nonVrStudents.length * tasks.reduce((sum, task) => sum + maxPoints[task], 0);
            
            competencyVR[comp] = (vrSum / maxPossibleVR) * 100;
            competencyNonVR[comp] = (nonVrSum / maxPossibleNonVR) * 100;
        });

        Plotly.newPlot('competencyChart', [
            {
                x: Object.keys(competencies),
                y: Object.values(competencyVR),
                name: 'VR',
                type: 'bar',
                marker: { color: '#3b82f6' },
                text: Object.values(competencyVR).map(v => v.toFixed(0) + '%'),
                textposition: 'outside',
                textfont: { color: '#e2e8f0', size: 8 }
            },
            {
                x: Object.keys(competencies),
                y: Object.values(competencyNonVR),
                name: 'Non-VR',
                type: 'bar',
                marker: { color: '#ec4899' },
                text: Object.values(competencyNonVR).map(v => v.toFixed(0) + '%'),
                textposition: 'outside',
                textfont: { color: '#e2e8f0', size: 8 }
            }
        ], {
            ...theme,
            barmode: 'group',
            yaxis: { ...theme.yaxis, title: { text: '%', font: { size: 9 } }, range: [0, 110] },
            autosize: true
        }, config);

        // 4. Bar Chart - Average per Task
        const taskAvgVR = {};
        const taskAvgNonVR = {};
        
        taskHeaders.forEach(task => {
            const vrSum = vrStudents.reduce((sum, s) => sum + s.tasks[task], 0);
            const nonVrSum = nonVrStudents.reduce((sum, s) => sum + s.tasks[task], 0);
            const vrMaxPossible = vrStudents.length * maxPoints[task];
            const nonVrMaxPossible = nonVrStudents.length * maxPoints[task];
            taskAvgVR[task] = (vrSum / vrMaxPossible) * 100;
            taskAvgNonVR[task] = (nonVrSum / nonVrMaxPossible) * 100;
        });

        Plotly.newPlot('taskBarChart', [
            {
                x: taskHeaders,
                y: Object.values(taskAvgVR),
                name: 'VR',
                type: 'bar',
                marker: { color: '#3b82f6' }
            },
            {
                x: taskHeaders,
                y: Object.values(taskAvgNonVR),
                name: 'Non-VR',
                type: 'bar',
                marker: { color: '#ec4899' }
            }
        ], {
            ...theme,
            barmode: 'group',
            yaxis: { ...theme.yaxis, title: { text: '%', font: { size: 9 } }, range: [0, 105] },
            autosize: true
        }, config);

        // 5. Heatmap - optimized for 30 participants
        const heatmapData = students.map(s => taskHeaders.map(task => s.tasks[task]));
        const heatmapDataPercent = students.map(s => taskHeaders.map(task => (s.tasks[task] / maxPoints[task]) * 100));
        const maxPointsArray = taskHeaders.map(task => maxPoints[task]);
        
        Plotly.newPlot('heatmap', [{
            z: heatmapDataPercent,
            x: taskHeaders,
            y: students.map(s => s.name),
            type: 'heatmap',
            colorscale: [
                [0, '#1e293b'],
                [0.25, '#dc2626'],
                [0.5, '#f59e0b'],
                [0.75, '#84cc16'],
                [1, '#10b981']
            ],
            text: heatmapData.map((row, i) => row.map((val, j) => {
                const max = maxPointsArray[j];
                return val === 0 ? '0' : val === max ? max.toString() : val.toFixed(1);
            })),
            texttemplate: '%{text}',
            textfont: { size: 6, color: '#e2e8f0' },
            colorbar: {
                title: { text: '%', side: 'right', font: { size: 7 } },
                tickvals: [0, 50, 100],
                ticktext: ['0', '50', '100'],
                len: 0.3,
                thickness: 8,
                tickfont: { color: '#94a3b8', size: 6 },
                titlefont: { color: '#94a3b8', size: 7 }
            },
            hovertemplate: '<b>%{y}</b><br>%{x}: %{text}<extra></extra>',
            zmin: 0,
            zmax: 100
        }], {
            plot_bgcolor: 'rgba(0,0,0,0)',
            paper_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#e2e8f0', size: 7 },
            margin: { l: 80, r: 30, t: 5, b: 35 },
            xaxis: { side: 'bottom', gridcolor: '#2d3748', tickfont: { size: 6 } },
            yaxis: { gridcolor: '#2d3748', tickfont: { size: 6 }, dtick: 1 },
            autosize: true
        }, config);
        }

        // Initialize charts on page load
        createCharts();

        // ============================================
        // QUALITATIVE DASHBOARD - Interview Analysis
        // ============================================

        // 8 Interview Questions with all 12 participants
        // Score: 1 = sehr positiv/stark, 0.5 = mittel/neutral, 0 = negativ/schwach
        
        const interviewQuestions = [
            {
                id: 'experience',
                title: 'Lernerfahrung vs. Unterricht',
                question: 'Wie Ã¤hnlich/verschieden war die Lernerfahrung zum regulÃ¤ren Unterricht?',
                responses: [
                    { name: 'Marlon', group: 'VR', score: 14.0, rating: 1, quote: 'â€žSehr verschieden. Der Anfang war Ã¤hnlicher zum normalen Unterricht, aber dann der VR-Teil war was ganz Neues."' },
                    { name: 'Floyd', group: 'VR', score: 14.0, rating: 1, quote: 'â€žWar sehr verschieden. Hat sich komplett anders angefÃ¼hlt zu Hause."' },
                    { name: 'Konstantin', group: 'VR', score: 12.5, rating: 1, quote: 'â€žSchon Ã¤hnlich, nicht ganz besser. Aber die 3D-Modelle mit Hintergrund, Vordergrund, so wie es sich verÃ¤ndert, fand ich besser."' },
                    { name: 'Louis', group: 'VR', score: 17.0, rating: 1, quote: 'â€žAnders, weil du konntest alles selbst sehen, anfassen und drehen. Es war schon sehr anders als normalerweise."' },
                    { name: 'Henri', group: 'VR', score: 17.5, rating: 1, quote: 'â€žSehr unterschiedlich, weil durch diese VR-Brille konnte ich mir das angucken und bewegen. Das war viel anschaulicher als der Unterricht auf Papier."' },
                    { name: 'Leni', group: 'Non-VR', score: 8.0, rating: 0.5, quote: 'â€žEigentlich ganz gleich, aber es ist halt so ein bisschen offener, nicht so in diesem Unterricht."' },
                    { name: 'Quentin', group: 'Non-VR', score: 8.5, rating: 1, quote: 'â€žEigentlich schon besser, weil ihr doch SchÃ¼ler seid."' },
                    { name: 'Tilly', group: 'Non-VR', score: 9.5, rating: 0.5, quote: 'â€žSchon Ã¤hnlich, ja."' },
                    { name: 'Alex', group: 'Non-VR', score: 9.0, rating: 0.5, quote: 'â€žEs war eigentlich ganz gut."' },
                    { name: 'Sophia', group: 'Non-VR', score: 11.5, rating: 0.5, quote: 'â€žEs war sehr Ã¤hnlich von der Lernstrategie, aber das war vier Jahre Stoff in einer Minute."' },
                    { name: 'Farah', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žEs war sehr Ã¤hnlich wie Unterricht, halt nur die Strategie war deutlicher und einfacher zu verstehen."' },
                    { name: 'Lucia', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žEs war schon sehr Ã¤hnlich, es war nur deutlich schneller und nicht so ausfÃ¼hrlich."' }
                ]
            },
            {
                id: 'difficulty',
                title: 'Themenschwierigkeit',
                question: 'Wie schwer fandest du das Thema im Vergleich zu anderen Chemie-Themen?',
                responses: [
                    { name: 'Marlon', group: 'VR', score: 14.0, rating: 0.5, quote: 'â€žSchon eher schwerer, aber dafÃ¼r habe ich es relativ gut verstanden."' },
                    { name: 'Floyd', group: 'VR', score: 14.0, rating: 0.5, quote: 'â€žIm Vergleich zu anderen Chemie-Themen fand ich es schon schwerer, aber wurde trotzdem gut erklÃ¤rt."' },
                    { name: 'Konstantin', group: 'VR', score: 12.5, rating: 0.5, quote: 'â€žSchon ein Fehler. Wenn man es richtig versteht, dann ist es einfacher, aber sonst eigentlich schon schwerer."' },
                    { name: 'Louis', group: 'VR', score: 17.0, rating: 0.5, quote: 'â€žEs ist schon ein schweres Thema, aber es war sehr anschaulich mit der VR-Brille."' },
                    { name: 'Henri', group: 'VR', score: 17.5, rating: 0.5, quote: 'â€žVon der Schwerheit ziemlich Ã¤hnlich wie andere Themen. Vielleicht noch ein bisschen lÃ¤nger hÃ¤tte ich gebraucht zum Lernen."' },
                    { name: 'Leni', group: 'Non-VR', score: 8.0, rating: 0.5, quote: 'â€žÃ„hnlich eigentlich. Vielleicht ein bisschen schwerer, aber eher Ã¤hnlich."' },
                    { name: 'Quentin', group: 'Non-VR', score: 8.5, rating: 0.5, quote: 'â€žEigentlich ziemlich gleich schwer wie die anderen, weil es war halt so relativ Ã¼bersichtlich."' },
                    { name: 'Tilly', group: 'Non-VR', score: 9.5, rating: 0.5, quote: 'â€žDer Anfang war einfach, das Ende fand ich ein bisschen komplizierter."' },
                    { name: 'Alex', group: 'Non-VR', score: 9.0, rating: 0.5, quote: 'â€žEinfacher als manch andere, aber auch nicht das Leichteste."' },
                    { name: 'Sophia', group: 'Non-VR', score: 11.5, rating: 0.5, quote: 'â€žEs ist machbar, das ist verstÃ¤ndlich."' },
                    { name: 'Farah', group: 'Non-VR', score: 7.0, rating: 0, quote: 'â€žIch fand es voll einfach."' },
                    { name: 'Lucia', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žDadurch, dass wir noch nicht alle Grundlagen haben, war es schon schwer. Aber das Thema ist nicht so schwer insgesamt."' }
                ]
            },
            {
                id: 'understanding',
                title: 'TiefenverstÃ¤ndnis',
                question: 'WÃ¼rdest du sagen, du hast ein tiefgrÃ¼ndiges VerstÃ¤ndnis fÃ¼r das Thema erlangt?',
                responses: [
                    { name: 'Marlon', group: 'VR', score: 14.0, rating: 1, quote: 'â€žJa, auf jeden Fall. Vor allem fÃ¼r die Zeit."' },
                    { name: 'Floyd', group: 'VR', score: 14.0, rating: 0.5, quote: 'â€žWurde trotzdem gut erklÃ¤rt, habe ich auch gut verstanden."' },
                    { name: 'Konstantin', group: 'VR', score: 12.5, rating: 0.5, quote: 'â€žFast. Also noch nicht ganz, aber ich habe es halt schon verstanden, wie sich die Atome dann beziehen."' },
                    { name: 'Louis', group: 'VR', score: 17.0, rating: 0, quote: 'â€žNee, wahrscheinlich noch nicht wirklich. DafÃ¼r mÃ¼sste ich mir das wahrscheinlich noch lÃ¤nger anschauen."' },
                    { name: 'Henri', group: 'VR', score: 17.5, rating: 1, quote: 'â€žIch hÃ¤tte jetzt ein anschaulicheres und was auch im Alltag mehr genutzt werden, nutzbares VerstÃ¤ndnis bekommen."' },
                    { name: 'Leni', group: 'Non-VR', score: 8.0, rating: 0, quote: 'â€žNicht so richtig."' },
                    { name: 'Quentin', group: 'Non-VR', score: 8.5, rating: 1, quote: 'â€žIch glaube schon, dass ich naturwissenschaftliche Sachen besser machen kann."' },
                    { name: 'Tilly', group: 'Non-VR', score: 9.5, rating: 0.5, quote: 'â€žDas Wichtigste verstanden, aber nicht alles."' },
                    { name: 'Alex', group: 'Non-VR', score: 9.0, rating: 0, quote: 'â€žNicht wirklich."' },
                    { name: 'Sophia', group: 'Non-VR', score: 11.5, rating: 0.5, quote: 'â€žIch habe das Wichtigste verstanden, aber jetzt nicht die genauen alle."' },
                    { name: 'Farah', group: 'Non-VR', score: 7.0, rating: 1, quote: 'â€žIch habe das meiste schon richtig gut verstanden."' },
                    { name: 'Lucia', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žDen ersten Teil habe ich gut verstanden. Die Keilstrichformel ist noch kompliziert, was wo vorn oder hinten ist."' }
                ]
            },
            {
                id: 'testRep',
                title: 'Test-ReprÃ¤sentation',
                question: 'Glaubst du, der Test reprÃ¤sentiert deine Leistungen gut?',
                responses: [
                    { name: 'Marlon', group: 'VR', score: 14.0, rating: 1, quote: 'â€žDefinitiv ja."' },
                    { name: 'Floyd', group: 'VR', score: 14.0, rating: 0, quote: 'â€žIch glaube, ich hÃ¤tte es deutlich besser machen kÃ¶nnen."' },
                    { name: 'Konstantin', group: 'VR', score: 12.5, rating: 0, quote: 'â€žIch hÃ¤tte an einem anderen Tag besser performt. Absolute Stille fehlte."' },
                    { name: 'Louis', group: 'VR', score: 17.0, rating: 0.5, quote: 'â€žDas hat wahrscheinlich mein KÃ¶nnen fÃ¼r das Thema schon reprÃ¤sentiert, aber nicht an sich an Chemie."' },
                    { name: 'Henri', group: 'VR', score: 17.5, rating: 0.5, quote: 'â€žIch hatte ein bisschen zu wenig Zeit. FÃ¼r die Zeit war es relativ okay."' },
                    { name: 'Leni', group: 'Non-VR', score: 8.0, rating: 1, quote: 'â€žAlso der war schon gut."' },
                    { name: 'Quentin', group: 'Non-VR', score: 8.5, rating: 0.5, quote: 'â€žIch glaube, es war wegen diesem zweiten Thema. War ich nicht so gut."' },
                    { name: 'Tilly', group: 'Non-VR', score: 9.5, rating: 1, quote: 'â€žReprÃ¤sentiert meine Leistungen gut."' },
                    { name: 'Alex', group: 'Non-VR', score: 9.0, rating: 1, quote: 'â€žWÃ¼rde sagen sogar besser als ich eigentlich wÃ¤re, durch diese Ankreuzaufgaben."' },
                    { name: 'Sophia', group: 'Non-VR', score: 11.5, rating: 1, quote: 'â€žIch glaube, ich hÃ¤tte ihn genau so geschrieben, wie ich ihn geschrieben habe."' },
                    { name: 'Farah', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žIch hÃ¤tte ihn vielleicht besser schreiben kÃ¶nnen."' },
                    { name: 'Lucia', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žMan sollte vielleicht davor ein bisschen mehr auf die Keilstrichformel eingehen."' }
                ]
            },
            {
                id: 'selfAssess',
                title: 'SelbsteinschÃ¤tzung Chemie',
                question: 'Wie schÃ¤tzt du dich in Chemie generell ein?',
                responses: [
                    { name: 'Marlon', group: 'VR', score: 14.0, rating: 0, quote: 'â€žTatsÃ¤chlich gar nicht. Noten sehr schlecht. Aber jetzt habe ich es verstanden."' },
                    { name: 'Floyd', group: 'VR', score: 14.0, rating: 0.5, quote: 'â€žEher so ein mittleres. Also eigentlich ganz okay, jetzt nicht super, aber auch nicht scheiÃŸe."' },
                    { name: 'Konstantin', group: 'VR', score: 12.5, rating: 0.5, quote: 'â€žIch habe schon Interesse. Zwei, drei Jahre. Ich finde Chemie super, aber schwieriger."' },
                    { name: 'Louis', group: 'VR', score: 17.0, rating: 0, quote: 'â€žAlso nicht so gut."' },
                    { name: 'Henri', group: 'VR', score: 17.5, rating: 1, quote: 'â€žIn Chemie schÃ¤tze ich mich relativ gut ein. Wenn ich es dann im Nachhinein lerne, lief bei mir jetzt relativ gut."' },
                    { name: 'Leni', group: 'Non-VR', score: 8.0, rating: 0, quote: 'â€žEher schwÃ¤cher."' },
                    { name: 'Quentin', group: 'Non-VR', score: 8.5, rating: 1, quote: 'â€žSchon eher einer meiner besseren FÃ¤cher wÃ¼rde ich schon sagen. Ich finde das halt oft auch sehr interessant zu verstehen."' },
                    { name: 'Tilly', group: 'Non-VR', score: 9.5, rating: 0.5, quote: 'â€žMeine Noten sind immer unterschiedlich. Im Unterricht interessiert mich das nicht so sehr."' },
                    { name: 'Alex', group: 'Non-VR', score: 9.0, rating: 0, quote: 'â€žInteresse da, aber ich bin ziemlich sehr, sehr, sehr schlecht."' },
                    { name: 'Sophia', group: 'Non-VR', score: 11.5, rating: 0.5, quote: 'â€žIch verstehe es schon. Ganz gut."' },
                    { name: 'Farah', group: 'Non-VR', score: 7.0, rating: 1, quote: 'â€žSo, ich bin schon sehr gut in Chemie."' },
                    { name: 'Lucia', group: 'Non-VR', score: 7.0, rating: 0, quote: 'â€žEinzelbereich." (Ã¼ber Noten)' }
                ]
            },
            {
                id: 'fun',
                title: 'LernspaÃŸ',
                question: 'Wie viel SpaÃŸ hattest du am Lernen?',
                responses: [
                    { name: 'Marlon', group: 'VR', score: 14.0, rating: 1, quote: 'â€žSehr viel SpaÃŸ."' },
                    { name: 'Floyd', group: 'VR', score: 14.0, rating: 1, quote: 'â€žIch habe auf jeden Fall mehr SpaÃŸ am Lernen, weil mit der VR-Brille ist immer mal was Neues."' },
                    { name: 'Konstantin', group: 'VR', score: 12.5, rating: 1, quote: 'â€žViel SpaÃŸ, also viel mehr SpaÃŸ als im Unterricht."' },
                    { name: 'Louis', group: 'VR', score: 17.0, rating: 1, quote: 'â€žDas Lernen hat schon SpaÃŸ gemacht, es war etwas sehr Neues und spannender als das normale Lernen."' },
                    { name: 'Henri', group: 'VR', score: 17.5, rating: 1, quote: 'â€žIch fand es auf jeden Fall spaÃŸiger als normalen Unterricht."' },
                    { name: 'Leni', group: 'Non-VR', score: 8.0, rating: 0, quote: 'â€žNicht so viel wie normalerweise. Eher weniger."' },
                    { name: 'Quentin', group: 'Non-VR', score: 8.5, rating: 1, quote: 'â€žIch hatte schon SpaÃŸ, weil ich fand es spannend, das Thema ein bisschen klar zu bekommen."' },
                    { name: 'Tilly', group: 'Non-VR', score: 9.5, rating: 0.5, quote: 'â€žEin bisschen."' },
                    { name: 'Alex', group: 'Non-VR', score: 9.0, rating: 0.5, quote: 'â€žIch hatte kein besonderes Missfallen am Unterricht, es war eigentlich ganz gut."' },
                    { name: 'Sophia', group: 'Non-VR', score: 11.5, rating: 0.5, quote: 'â€žEs war jetzt kein groÃŸer Unterschied."' },
                    { name: 'Farah', group: 'Non-VR', score: 7.0, rating: 1, quote: 'â€žJa, ich hatte mehr SpaÃŸ, also es war spannender."' },
                    { name: 'Lucia', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žBisschen mehr schon."' }
                ]
            },
            {
                id: 'groupWish',
                title: 'Gruppenwunsch',
                question: 'HÃ¤ttest du dir gewÃ¼nscht, in der anderen Gruppe zu sein?',
                responses: [
                    { name: 'Marlon', group: 'VR', score: 14.0, rating: 1, quote: 'â€žNee."' },
                    { name: 'Floyd', group: 'VR', score: 14.0, rating: 1, quote: 'â€žNee."' },
                    { name: 'Konstantin', group: 'VR', score: 12.5, rating: 1, quote: 'â€žNein, weil ich so besser veranschauliche."' },
                    { name: 'Louis', group: 'VR', score: 17.0, rating: 1, quote: 'â€žNee, das ist auch so spannend, das ist was Neues."' },
                    { name: 'Henri', group: 'VR', score: 17.5, rating: 0.5, quote: 'â€žMeiner Meinung nach sind die Ergebnisse der anderen Gruppe wahrscheinlich besser. Aber okay, dann doch nicht."' },
                    { name: 'Leni', group: 'Non-VR', score: 8.0, rating: 0, quote: 'â€žJa." (wÃ¼rde VR wÃ¤hlen)' },
                    { name: 'Quentin', group: 'Non-VR', score: 8.5, rating: 1, quote: 'â€žNee, ich fand das eigentlich ganz cool mit der Tafel das zu malen."' },
                    { name: 'Tilly', group: 'Non-VR', score: 9.5, rating: 0, quote: 'â€žJa." (wÃ¼rde VR wÃ¤hlen)' },
                    { name: 'Alex', group: 'Non-VR', score: 9.0, rating: 0, quote: 'â€žWenn ich nochmal die Wahl hÃ¤tte, wÃ¼rde ich wahrscheinlich schon lieber das mit der VR-Brille nehmen."' },
                    { name: 'Sophia', group: 'Non-VR', score: 11.5, rating: 0.5, quote: 'â€žDas wÃ¤re mir eigentlich egal gewesen."' },
                    { name: 'Farah', group: 'Non-VR', score: 7.0, rating: 0, quote: 'â€žAlso ich wollte, aber ich fand es eigentlich cool."' },
                    { name: 'Lucia', group: 'Non-VR', score: 7.0, rating: 0, quote: 'â€žJa." (wÃ¼rde VR wÃ¤hlen)' }
                ]
            },
            {
                id: 'feedback',
                title: 'Generelles Feedback',
                question: 'Was fandest du gut/schlecht? Generelles Feedback?',
                responses: [
                    { name: 'Marlon', group: 'VR', score: 14.0, rating: 1, quote: 'â€žWirklich sehr guter Unterricht, sehr gut erklÃ¤rt. Besser als viele Lehrer. Und die VR-Brille war auch sehr cool."' },
                    { name: 'Floyd', group: 'VR', score: 14.0, rating: 0.5, quote: 'â€žNÃ¶." (kein besonderes Feedback)' },
                    { name: 'Konstantin', group: 'VR', score: 12.5, rating: 0.5, quote: 'â€žGut, dass man das mit 3D-Dingen machen kann. Was mir nicht gefallen hat: man kann es nicht nachlesen."' },
                    { name: 'Louis', group: 'VR', score: 17.0, rating: 0.5, quote: 'â€žDas war gut, spannend, was Neues. Aber man hatte zu wenig Zeit, um das Thema wirklich zu verstehen."' },
                    { name: 'Henri', group: 'VR', score: 17.5, rating: 0.5, quote: 'â€žIch fand das sehr interessant. Ging relativ schnell. Wenn ich mir das lÃ¤nger hÃ¤tte angucken kÃ¶nnen, wÃ¤re es besser."' },
                    { name: 'Leni', group: 'Non-VR', score: 8.0, rating: 1, quote: 'â€žIhr habt es eigentlich ganz gut erklÃ¤rt."' },
                    { name: 'Quentin', group: 'Non-VR', score: 8.5, rating: 1, quote: 'â€žGut, dass ihr das selber geprÃ¼ft habt, ob wir es verstanden haben. Gut mit den Folien und unterschiedlichen Bildern."' },
                    { name: 'Tilly', group: 'Non-VR', score: 9.5, rating: 0.5, quote: 'â€žEigentlich echt gut erklÃ¤rt. Bisschen schwierig fÃ¼r neue Sachen. Und die Zeit war ja auch sehr gewiss."' },
                    { name: 'Alex', group: 'Non-VR', score: 9.0, rating: 0.5, quote: 'â€žVielleicht bisschen lÃ¤nger erklÃ¤ren. Viele Beispiele genutzt und vor allem verstÃ¤ndliche Beispiele."' },
                    { name: 'Sophia', group: 'Non-VR', score: 11.5, rating: 0, quote: 'â€žDer Test war sehr schwer."' },
                    { name: 'Farah', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žNe." (kein spezifisches Feedback)' },
                    { name: 'Lucia', group: 'Non-VR', score: 7.0, rating: 0.5, quote: 'â€žKeine Ahnung." (nichts spezifisches)' }
                ]
            }
        ];

        // Calculate average rating per question per group
        function calculateAvgRating(question, group) {
            const responses = question.responses.filter(r => r.group === group);
            const avg = responses.reduce((sum, r) => sum + r.rating, 0) / responses.length;
            return Math.round(avg * 100);
        }

        const vrInterviews = interviewQuestions[0].responses.filter(r => r.group === 'VR');
        const nonVrInterviews = interviewQuestions[0].responses.filter(r => r.group === 'Non-VR');

        // Build qualitative dashboard with 8 questions layout - ALL 12 quotes per question
        function buildQualitativeDashboard() {
            const container = document.getElementById('qualContainer');
            
            let html = `
                <div class="qual-main-grid">
            `;

            // Create 8 question cards (4x2 grid)
            interviewQuestions.forEach((q, idx) => {
                const vrAvg = calculateAvgRating(q, 'VR');
                const nonVrAvg = calculateAvgRating(q, 'Non-VR');
                
                // Sort responses: VR first, then Non-VR
                const vrResponses = q.responses.filter(r => r.group === 'VR');
                const nonVrResponses = q.responses.filter(r => r.group === 'Non-VR');

                // Build all quotes HTML
                const allQuotesHtml = [...vrResponses, ...nonVrResponses].map(r => `
                    <div class="qual-quote ${r.group === 'VR' ? 'vr' : 'non-vr'}">
                        <div class="qual-quote-text">${r.quote}</div>
                        <div class="qual-quote-meta">
                            <span class="qual-quote-name">${r.name}</span>
                            <span class="qual-quote-badge ${r.group === 'VR' ? 'vr' : 'non-vr'}">${r.group}</span>
                            <span class="qual-quote-score">${r.score}/20</span>
                        </div>
                    </div>
                `).join('');

                html += `
                    <div class="qual-q-card">
                        <div class="qual-q-header">
                            <span class="qual-q-number">${idx + 1}</span>
                            <div class="qual-q-title-wrap">
                                <div class="qual-q-title">${q.title}</div>
                                <div class="qual-q-question">${q.question}</div>
                            </div>
                        </div>
                        <div class="qual-q-stats">
                            <div class="qual-q-stat">
                                <div class="qual-q-stat-bar">
                                    <div class="qual-q-stat-fill vr" style="width: ${vrAvg}%"></div>
                                </div>
                                <div class="qual-q-stat-info">
                                    <span class="qual-q-stat-label">VR (n=5)</span>
                                    <span class="qual-q-stat-value vr">${vrAvg}%</span>
                                </div>
                            </div>
                            <div class="qual-q-stat">
                                <div class="qual-q-stat-bar">
                                    <div class="qual-q-stat-fill non-vr" style="width: ${nonVrAvg}%"></div>
                                </div>
                                <div class="qual-q-stat-info">
                                    <span class="qual-q-stat-label">Non-VR (n=7)</span>
                                    <span class="qual-q-stat-value non-vr">${nonVrAvg}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="qual-q-quotes">
                            ${allQuotesHtml}
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            container.innerHTML = html;
        }

        // Dashboard navigation
        function showDashboard(view) {
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.dashboard-view').forEach(v => v.classList.remove('active'));
            document.getElementById(`${view}-view`).classList.add('active');

            const title = document.getElementById('dashboardTitle');
            if (view === 'quantitative') {
                title.textContent = 'Quantitative Analyse';
                // Resize quantitative charts
                Plotly.Plots.resize('violinPlot');
                Plotly.Plots.resize('difficultyChart');
                Plotly.Plots.resize('competencyChart');
                Plotly.Plots.resize('taskBarChart');
                Plotly.Plots.resize('heatmap');
            } else if (view === 'qualitative') {
                title.textContent = 'Qualitative Analyse â€” Interviews (n=12)';
                // Build qualitative dashboard
                buildQualitativeDashboard();
            } else if (view === 'triangulation') {
                title.textContent = 'Triangulation â€” Mixed Methods';
                // Build triangulation dashboard
                buildTriangulationDashboard();
            }
        }

        // Triangulation Dashboard - combines quantitative and qualitative data
        function buildTriangulationDashboard() {
            const container = document.getElementById('triContainer');
            
            // Get interviewed participants with their test scores AND Transfer scores (Task_5a, 5b, 6a, 6b)
            // Transfer max = 2+2+3+2 = 9 points
            // Ratings based on actual interview transcripts
            const interviewedParticipants = [
                { name: 'Marlon', fullName: 'Marlon Burg', group: 'VR', score: 11.0, transferScore: 6.0, funRating: 95, understandingRating: 85 },
                { name: 'Floyd', fullName: 'Floyd', group: 'VR', score: 14.0, transferScore: 6.0, funRating: 88, understandingRating: 70 },
                { name: 'Konstantin', fullName: 'Konstantin Romanie', group: 'VR', score: 12.5, transferScore: 3.0, funRating: 92, understandingRating: 60 },
                { name: 'Louis', fullName: 'Louis Plettner', group: 'VR', score: 17.0, transferScore: 7.0, funRating: 82, understandingRating: 15 },
                { name: 'Henri', fullName: 'Henri Olufemi', group: 'VR', score: 17.5, transferScore: 6.0, funRating: 85, understandingRating: 90 },
                { name: 'Leni', fullName: 'Leni Koschinsky', group: 'Non-VR', score: 8.0, transferScore: 3.0, funRating: 20, understandingRating: 15 },
                { name: 'Quentin', fullName: 'Quentin Lumbondl', group: 'Non-VR', score: 8.5, transferScore: 3.0, funRating: 75, understandingRating: 80 },
                { name: 'Tilly', fullName: 'Tilly Marr', group: 'Non-VR', score: 9.5, transferScore: 2.0, funRating: 48, understandingRating: 55 },
                { name: 'Alex', fullName: 'Alex Orthen', group: 'Non-VR', score: 9.0, transferScore: 3.0, funRating: 52, understandingRating: 10 },
                { name: 'Sophia', fullName: 'Sophia Kessler', group: 'Non-VR', score: 11.5, transferScore: 2.0, funRating: 50, understandingRating: 62 },
                { name: 'Farah', fullName: 'Farah Raad', group: 'Non-VR', score: 7.0, transferScore: 3.0, funRating: 78, understandingRating: 80 },
                { name: 'Lucia', fullName: 'Lucia Naverth', group: 'Non-VR', score: 7.0, transferScore: 1.0, funRating: 55, understandingRating: 65 }
            ];

            // All 12 triangulation cases with REAL quotes from transcripts
            const triangulationCases = [
                {
                    name: 'Louis',
                    group: 'VR',
                    score: 17.0,
                    transferScore: 7.0,
                    tag: 'paradox',
                    tagLabel: 'Paradox',
                    quant: 'Zweitbester Score (17/20), Transfer: 7/9 (78%) â€” starke rÃ¤umliche Leistung',
                    qual: 'â€žNee, wahrscheinlich noch nicht wirklich. DafÃ¼r mÃ¼sste ich mir das wahrscheinlich noch lÃ¤nger anschauen"',
                    insight: 'Hohe Test-Performance â‰  gefÃ¼hltes VerstÃ¤ndnis (15%). Zeitdruck fÃ¼hrt zu kurzfristigem Erfolg ohne TiefenverstÃ¤ndnis'
                },
                {
                    name: 'Henri',
                    group: 'VR',
                    score: 17.5,
                    transferScore: 6.0,
                    tag: 'expected',
                    tagLabel: 'Konsistent',
                    quant: 'Bester Score (17.5/20), Transfer: 6/9 (67%)',
                    qual: 'â€žIch hÃ¤tte jetzt ein anschaulicheres und was auch im Alltag mehr genutzt werden, nutzbares VerstÃ¤ndnis bekommen"',
                    insight: 'Idealer VR-Effekt: Hohe Leistung + hohe Selbstreflexion (90%) + Alltagstransfer'
                },
                {
                    name: 'Marlon',
                    group: 'VR',
                    score: 11.0,
                    transferScore: 6.0,
                    tag: 'vr-boost',
                    tagLabel: 'VR-Effekt',
                    quant: 'Mittlerer Score (11/20), aber starker Transfer: 6/9 (67%)',
                    qual: 'â€žTatsÃ¤chlich gar nicht. Noten sehr schlecht. Aber jetzt habe ich es verstanden. Sehr viel SpaÃŸ"',
                    insight: 'VR kompensiert schwache Grundlagen: 95% SpaÃŸ, 85% VerstÃ¤ndnis trotz schlechter Chemie-Noten'
                },
                {
                    name: 'Floyd',
                    group: 'VR',
                    score: 14.0,
                    transferScore: 6.0,
                    tag: 'expected',
                    tagLabel: 'Konsistent',
                    quant: 'Guter Score (14/20), Transfer: 6/9 (67%)',
                    qual: 'â€žWurde trotzdem gut erklÃ¤rt, habe ich auch gut verstanden. Mehr SpaÃŸ, weil mit der VR-Brille ist immer mal was Neues"',
                    insight: 'Solide Performance mit angemessener SelbsteinschÃ¤tzung. VR steigert Motivation (88% SpaÃŸ)'
                },
                {
                    name: 'Konstantin',
                    group: 'VR',
                    score: 12.5,
                    transferScore: 3.0,
                    tag: 'paradox',
                    tagLabel: 'Paradox',
                    quant: 'Mittlerer Score (12.5/20), aber schwacher Transfer: nur 3/9 (33%)',
                    qual: 'â€žFast. Also noch nicht ganz, aber ich habe es halt schon verstanden, wie sich die Atome dann beziehen"',
                    insight: 'Realistische SelbsteinschÃ¤tzung (60%): Transfer-SchwÃ¤che spiegelt unvollstÃ¤ndiges VerstÃ¤ndnis wider'
                },
                {
                    name: 'Sophia',
                    group: 'Non-VR',
                    score: 11.5,
                    transferScore: 2.0,
                    tag: 'paradox',
                    tagLabel: 'Paradox',
                    quant: 'Beste Non-VR (11.5/20), aber schwÃ¤chster Transfer: 2/9 (22%)',
                    qual: 'â€žIch habe das Wichtigste verstanden, aber nicht die genauen alle. Vier Jahre Stoff in einer Minute"',
                    insight: 'Ohne VR: Gute Grundlagen (62% VerstÃ¤ndnis), aber rÃ¤umlicher Transfer scheitert. Zeitdruck als Faktor'
                },
                {
                    name: 'Quentin',
                    group: 'Non-VR',
                    score: 8.5,
                    transferScore: 3.0,
                    tag: 'paradox',
                    tagLabel: 'Paradox',
                    quant: 'Niedriger Score (8.5/20), Transfer: 3/9 (33%)',
                    qual: 'â€žSchon eher einer meiner besseren FÃ¤cher. Ich hatte schon SpaÃŸ, ich finde das sehr interessant zu verstehen"',
                    insight: 'Hohe Motivation (75% SpaÃŸ, 80% VerstÃ¤ndnis) â‰  hohe Leistung. Interesse kann WissenslÃ¼cken nicht kompensieren'
                },
                {
                    name: 'Farah',
                    group: 'Non-VR',
                    score: 7.0,
                    transferScore: 3.0,
                    tag: 'expected',
                    tagLabel: 'Konsistent',
                    quant: 'Schwacher Score (7/20), Transfer: 3/9 (33%)',
                    qual: 'â€žIch habe das meiste schon richtig gut verstanden. Bin schon sehr gut in Chemie. Hatte mehr SpaÃŸ"',
                    insight: 'Hohe SelbsteinschÃ¤tzung (80% VerstÃ¤ndnis, "sehr gut in Chemie") steht im Kontrast zu objektiv schwacher Leistung'
                },
                {
                    name: 'Lucia',
                    group: 'Non-VR',
                    score: 7.0,
                    transferScore: 1.0,
                    tag: 'expected',
                    tagLabel: 'Konsistent',
                    quant: 'Schwacher Score (7/20), schwÃ¤chster Transfer: 1/9 (11%)',
                    qual: 'â€žDen ersten Teil habe ich gut verstanden. Die Keilstrichformel ist noch kompliziert, was wo vorn oder hinten ist"',
                    insight: 'Ohne VR: Keilstrich bleibt abstrakt. Realistische SelbsteinschÃ¤tzung der SchwÃ¤chen (65%)'
                },
                {
                    name: 'Tilly',
                    group: 'Non-VR',
                    score: 9.5,
                    transferScore: 2.0,
                    tag: 'expected',
                    tagLabel: 'Konsistent',
                    quant: 'Niedriger Score (9.5/20), sehr schwacher Transfer: 2/9 (22%)',
                    qual: 'â€žDas Wichtigste verstanden, aber nicht alles. Der Anfang war einfach, das Ende komplizierter"',
                    insight: 'Realistische SelbsteinschÃ¤tzung: Erkennt eigene Grenzen bei Keilstrich-Transfer'
                },
                {
                    name: 'Alex',
                    group: 'Non-VR',
                    score: 9.0,
                    transferScore: 3.0,
                    tag: 'paradox',
                    tagLabel: 'Paradox',
                    quant: 'Niedriger Score (9/20), Transfer: 3/9 (33%)',
                    qual: 'â€žNicht wirklich verstanden. WÃ¼rde sagen sogar besser als ich eigentlich wÃ¤re â€” durch diese Ankreuzaufgaben"',
                    insight: 'Testformat-Kritik: MC-Aufgaben kÃ¶nnen wahres Wissen verschleiern. Ehrliche Selbstreflexion (10%)'
                },
                {
                    name: 'Leni',
                    group: 'Non-VR',
                    score: 8.0,
                    transferScore: 3.0,
                    tag: 'expected',
                    tagLabel: 'Konsistent',
                    quant: 'Schwacher Score (8/20), Transfer: 3/9 (33%)',
                    qual: 'â€žNicht so richtig verstanden. Nicht so viel SpaÃŸ wie normalerweise, eher weniger"',
                    insight: 'Konsistent schwach: Niedrige Leistung + niedriges VerstÃ¤ndnis (15%) + niedrige Motivation (20%)'
                }
            ];

            // Calculate group averages for transfer
            const vrTransferAvg = interviewedParticipants.filter(p => p.group === 'VR').reduce((s,p) => s + p.transferScore, 0) / 5;
            const nonVrTransferAvg = interviewedParticipants.filter(p => p.group === 'Non-VR').reduce((s,p) => s + p.transferScore, 0) / 7;

            let html = `
                <div class="tri-header">
                    <div class="tri-insight">
                        <div class="tri-insight-icon finding">ðŸ“Š</div>
                        <div class="tri-insight-content">
                            <div class="tri-insight-title">Transfer-Aufgaben</div>
                            <div class="tri-insight-desc">VR: Ã˜ ${vrTransferAvg.toFixed(1)}/9 (${(vrTransferAvg/9*100).toFixed(0)}%) | Non-VR: Ã˜ ${nonVrTransferAvg.toFixed(1)}/9 (${(nonVrTransferAvg/9*100).toFixed(0)}%) â€” VR zeigt deutlich stÃ¤rkeren 3D-Transfer</div>
                        </div>
                    </div>
                    <div class="tri-insight">
                        <div class="tri-insight-icon paradox">ðŸ”</div>
                        <div class="tri-insight-content">
                            <div class="tri-insight-title">Performance-VerstÃ¤ndnis-Gap</div>
                            <div class="tri-insight-desc">Louis: Transfer 78% aber nur 25% gefÃ¼hltes VerstÃ¤ndnis | Marlon: 67% Transfer trotz "schlechter Chemie-SchÃ¼ler"</div>
                        </div>
                    </div>
                    <div class="tri-insight">
                        <div class="tri-insight-icon vr-effect">ðŸŽ®</div>
                        <div class="tri-insight-content">
                            <div class="tri-insight-title">VR-Motivation</div>
                            <div class="tri-insight-desc">VR-SpaÃŸ: Ã˜ ${(interviewedParticipants.filter(p => p.group === 'VR').reduce((s,p) => s + p.funRating, 0) / 5).toFixed(0)}% | Non-VR: Ã˜ ${(interviewedParticipants.filter(p => p.group === 'Non-VR').reduce((s,p) => s + p.funRating, 0) / 7).toFixed(0)}% â€” VR steigert Lernfreude signifikant</div>
                        </div>
                    </div>
                    <div class="tri-insight">
                        <div class="tri-insight-icon paradox">âš ï¸</div>
                        <div class="tri-insight-content">
                            <div class="tri-insight-title">Limitationen: Selbstselektion</div>
                            <div class="tri-insight-desc">Selbstselektion der Probanden kÃ¶nnte Bias erzeugt haben. Eine Randomisierung wÃ¤re fÃ¼r hÃ¶here interne ValiditÃ¤t wÃ¼nschenswert gewesen.</div>
                        </div>
                    </div>
                    <div class="tri-insight">
                        <div class="tri-insight-icon paradox">âš ï¸</div>
                        <div class="tri-insight-content">
                            <div class="tri-insight-title">Limitationen: StichprobengrÃ¶ÃŸe</div>
                            <div class="tri-insight-desc">Mit n=15 (VR) und n=15 (Non-VR) ist die Stichprobe relativ klein. Resultate sollten in grÃ¶ÃŸeren Studien repliziert werden.</div>
                        </div>
                    </div>
                </div>

                <div class="tri-panel">
                    <div class="tri-panel-title">ðŸ“ˆ LernspaÃŸ vs. Gesamtscore</div>
                    <div class="tri-panel-content">
                        <div class="tri-chart" id="triScatterChart"></div>
                    </div>
                </div>

                <div class="tri-panel">
                    <div class="tri-panel-title">ðŸ§  VerstÃ¤ndnis (Interview) vs. Transfer-Aufgaben (Test)</div>
                    <div class="tri-panel-content">
                        <div class="tri-chart" id="triTransferChart"></div>
                    </div>
                </div>

                <div class="tri-panel" style="grid-column: 1 / -1;">
                    <div class="tri-panel-title">ðŸ”— Alle 12 Triangulations-FÃ¤lle â€” Quantitativ + Qualitativ</div>
                    <div class="tri-panel-content">
                        <div class="tri-profiles" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 12px;">
                            ${triangulationCases.map(c => `
                                <div class="tri-case">
                                    <div class="tri-case-header">
                                        <span class="tri-case-name">${c.name} (${c.group}) â€” ${c.score}/20 | Transfer: ${c.transferScore}/9</span>
                                        <span class="tri-case-tag ${c.tag}">${c.tagLabel}</span>
                                    </div>
                                    <div class="tri-case-content">
                                        <div class="tri-case-quant"><strong>Quantitativ:</strong> ${c.quant}</div>
                                        <div class="tri-case-qual"><strong>Qualitativ:</strong> ${c.qual}</div>
                                    </div>
                                    <div class="tri-profile-quote" style="margin-top: 6px; color: #10b981;">â†’ ${c.insight}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;

            // Create charts
            setTimeout(() => {
                const vrParticipants = interviewedParticipants.filter(p => p.group === 'VR');
                const nonVrParticipants = interviewedParticipants.filter(p => p.group === 'Non-VR');

                // Chart 1: Score vs. Fun Rating mit qualitativen Zitaten
                Plotly.newPlot('triScatterChart', [
                    {
                        x: vrParticipants.map(p => p.score),
                        y: vrParticipants.map(p => p.funRating),
                        mode: 'markers+text',
                        type: 'scatter',
                        name: 'VR',
                        text: vrParticipants.map(p => p.name),
                        textposition: 'top center',
                        textfont: { size: 8, color: '#e2e8f0' },
                        marker: {
                            color: '#3b82f6',
                            size: 14,
                            line: { color: 'white', width: 1 }
                        },
                        customdata: vrParticipants.map(p => [p.qual]),
                        hovertemplate: '<b>%{text}</b><br>Gesamtscore: %{x}/20<br>LernspaÃŸ-Rating: %{y}%<br><br><i>Zitat:</i><br>%{customdata[0]}<extra>VR</extra>'
                    },
                    {
                        x: nonVrParticipants.map(p => p.score),
                        y: nonVrParticipants.map(p => p.funRating),
                        mode: 'markers+text',
                        type: 'scatter',
                        name: 'Non-VR',
                        text: nonVrParticipants.map(p => p.name),
                        textposition: 'top center',
                        textfont: { size: 8, color: '#e2e8f0' },
                        marker: {
                            color: '#ec4899',
                            size: 14,
                            line: { color: 'white', width: 1 }
                        },
                        customdata: nonVrParticipants.map(p => [p.qual]),
                        hovertemplate: '<b>%{text}</b><br>Gesamtscore: %{x}/20<br>LernspaÃŸ-Rating: %{y}%<br><br><i>Zitat:</i><br>%{customdata[0]}<extra>Non-VR</extra>'
                    }
                ], {
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: '#e2e8f0', size: 9 },
                    margin: { l: 60, r: 20, t: 35, b: 55 },
                    xaxis: {
                        title: { text: 'Gesamtscore im Test (von 20 Punkten)', font: { size: 11, color: '#cbd5e1' } },
                        gridcolor: '#2d3748',
                        range: [5, 20],
                        tickfont: { size: 9 },
                        dtick: 2
                    },
                    yaxis: {
                        title: { text: 'LernspaÃŸ-Rating aus Interview (0-100%)', font: { size: 11, color: '#cbd5e1' } },
                        gridcolor: '#2d3748',
                        range: [0, 105],
                        tickfont: { size: 9 },
                        dtick: 20
                    },
                    legend: {
                        orientation: 'h',
                        y: 1.15,
                        x: 0.5,
                        xanchor: 'center',
                        font: { size: 10 }
                    },
                    autosize: true,
                    shapes: [
                        { type: 'line', x0: 5, x1: 20, y0: 70, y1: 70, line: { color: '#475569', width: 1, dash: 'dot' } }
                    ],
                    annotations: [
                        { x: 18, y: 98, text: 'VR: Hoher SpaÃŸ unabhÃ¤ngig vom Score', showarrow: false, font: { size: 8, color: '#3b82f6' } },
                        { x: 8, y: 25, text: 'Non-VR: GroÃŸe Streuung', showarrow: false, font: { size: 8, color: '#ec4899' } }
                    ]
                }, {responsive: true, displayModeBar: false});

                // Chart 2: Understanding Rating vs. Transfer Score mit qualitativen Zitaten
                Plotly.newPlot('triTransferChart', [
                    {
                        x: vrParticipants.map(p => p.understandingRating),
                        y: vrParticipants.map(p => (p.transferScore / 9) * 100),
                        mode: 'markers+text',
                        type: 'scatter',
                        name: 'VR',
                        text: vrParticipants.map(p => p.name),
                        textposition: 'top center',
                        textfont: { size: 8, color: '#e2e8f0' },
                        marker: {
                            color: '#3b82f6',
                            size: 14,
                            symbol: 'diamond',
                            line: { color: 'white', width: 1 }
                        },
                        customdata: vrParticipants.map(p => [p.qual, p.insight]),
                        hovertemplate: '<b>%{text}</b><br>VerstÃ¤ndnis-Rating: %{x}%<br>Transfer-Score: %{y:.0f}%<br><br><i>Zitat:</i><br>%{customdata[0]}<br><br><i>Insight:</i><br>%{customdata[1]}<extra>VR</extra>'
                    },
                    {
                        x: nonVrParticipants.map(p => p.understandingRating),
                        y: nonVrParticipants.map(p => (p.transferScore / 9) * 100),
                        mode: 'markers+text',
                        type: 'scatter',
                        name: 'Non-VR',
                        text: nonVrParticipants.map(p => p.name),
                        textposition: 'top center',
                        textfont: { size: 8, color: '#e2e8f0' },
                        marker: {
                            color: '#ec4899',
                            size: 14,
                            symbol: 'diamond',
                            line: { color: 'white', width: 1 }
                        },
                        customdata: nonVrParticipants.map(p => [p.qual, p.insight]),
                        hovertemplate: '<b>%{text}</b><br>VerstÃ¤ndnis-Rating: %{x}%<br>Transfer-Score: %{y:.0f}%<br><br><i>Zitat:</i><br>%{customdata[0]}<br><br><i>Insight:</i><br>%{customdata[1]}<extra>Non-VR</extra>'
                    }
                ], {
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: '#e2e8f0', size: 9 },
                    margin: { l: 60, r: 20, t: 35, b: 60 },
                    xaxis: {
                        title: { text: 'VerstÃ¤ndnis-Rating aus Interview (0-100%)', font: { size: 11, color: '#cbd5e1' } },
                        gridcolor: '#2d3748',
                        range: [0, 100],
                        tickfont: { size: 9 },
                        dtick: 20
                    },
                    yaxis: {
                        title: { text: 'Transfer-Aufgaben im Test (Task 5a/b, 6a/b: 0-100%)', font: { size: 11, color: '#cbd5e1' } },
                        gridcolor: '#2d3748',
                        range: [0, 100],
                        tickfont: { size: 9 },
                        dtick: 20
                    },
                    legend: {
                        orientation: 'h',
                        y: 1.15,
                        x: 0.5,
                        xanchor: 'center',
                        font: { size: 10 }
                    },
                    autosize: true,
                    shapes: [
                        { type: 'line', x0: 0, x1: 100, y0: 0, y1: 100, line: { color: '#475569', width: 1, dash: 'dot' } }
                    ],
                    annotations: [
                        { x: 15, y: 78, text: 'Louis: â¬†ï¸ Transfer,<br>â¬‡ï¸ VerstÃ¤ndnis', showarrow: true, arrowhead: 2, arrowcolor: '#f59e0b', font: { size: 8, color: '#f59e0b' }, ax: -40, ay: 20 },
                        { x: 85, y: 67, text: 'Marlon: â¬†ï¸ beides', showarrow: true, arrowhead: 2, arrowcolor: '#10b981', font: { size: 8, color: '#10b981' }, ax: 30, ay: -20 },
                        { x: 62, y: 22, text: 'Sophia: â¬‡ï¸ Transfer<br>trotz VerstÃ¤ndnis', showarrow: true, arrowhead: 2, arrowcolor: '#ef4444', font: { size: 8, color: '#ef4444' }, ax: 40, ay: 20 },
                        { x: 85, y: 8, text: 'Diagonale = Perfekte<br>Ãœbereinstimmung', showarrow: false, font: { size: 7, color: '#64748b' } }
                    ]
                }, {responsive: true, displayModeBar: false});
            }, 100);
        }

        // Make showDashboard globally accessible
        window.showDashboard = showDashboard;
    </script>
</body>
</html>